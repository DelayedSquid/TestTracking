
(function(){function q(a){var b={},d=new a.HistoryHTML5;d.on("change",function(c){if(c.src===a.HistoryHTML5.SRC_POPSTATE){l=!0;var b=c.changed.state;b?f.RefreshSources(b.newVal):(c.halt(!0),window.history.go(-1));l=!1}});return{enabled:!0,addState:function(a,b,m){d[m?"replace":"add"]({state:b},{url:g.getCurrentPage()+a})},checkCache:function(a){return a in b?b[a]:null},setCache:function(a,d){b[a]=d}}}var h,p,g,f,l=!1;"pushState"in window.history?YUI().use("history-html5",function(a){h=q(a)}):h={enabled:!1};p=function(){function a(a,b){this.sourceCollection[b.sourceID]={response:a,filters:b.filters,sourceID:b.sourceID};this.completedSourceAjaxSearches++;this.completedSourceAjaxSearches===this.sourceCount&&(f.RefreshSources(this.sourceCollection),h.setCache(b.historyKey,this.sourceCollection),h.addState(b.historyKey,this.sourceCollection,b.isRestoring),this.completedSourceAjaxSearches=0,this.sourceCollection={})}function b(b,c,d){RightNow.Ajax.makeRequest(b,c,{successHandler:a,failureHandler:function(a){var b=RightNow.Interface.getMessage("ERROR_REQUEST_ACTION_COMPLETED_MSG");403===a.status&&void 0!==a.responseText&&(b=a.responseText);RightNow.UI.Dialog.messageDialog(b,{icon:"WARN",exitCallback:function(){window.location.reload(!0)}})},json:!0,data:d,timeout:1E4})}function d(a,c,d,k,r){this.sourceCount=k;k=g.getFilterUrl(a);var n=h.checkCache(k);if(n)f.RefreshSources(n),h.addState(k,n,l);else if("/"===k)r.fire("response",new RightNow.Event.EventObject(null,{data:{}}));else{if(!c.endpoint)throw Error("An endpoint hasn't been specified");b(c.endpoint,e.mix({sourceID:d,filters:RightNow.JSON.stringify(a),limit:c.limit},c.params),{sourceID:d,historyKey:k,filters:a,isRestoring:l})}}function c(a,b){if(!this.refreshInProgress){var c=RightNow.Url.addParameter((b.new_page||g.getCurrentPage())+g.getFilterUrl(a),"session",RightNow.Url.getSession());"_self"===b.target?RightNow.Url.navigate(c,!0):window.open(c,b.target||"_self");this.refreshInProgress=!0}}var e=YUI();this.completedSourceAjaxSearches=this.sourceCount=0;this.sourceCollection={};return{go:function(a,b,e,k,f){!h.enabled||b&&(b.new_page||!b.endpoint)?c(a,b):d(a,b,e,k,f)}}}();g={alphanumericSort:function(a,b){return a<b?-1:a>b?1:0},getFilterUrl:function(a){var b=[],d={},c,e;for(c in a)a.hasOwnProperty(c)&&(e=a[c],!e.key||d[e.key]||!e.value&&0!==e.value&&!1!==e.value||(b.push(e.key),d[e.key]=e.value));b.sort(g.alphanumericSort);for(a="";c=b.shift();)a+="/"+c+"/"+encodeURIComponent(d[c]);return a},getFlattenedFilters:function(a){var b={},d,c;for(c in a)a.hasOwnProperty(c)&&"object"===typeof a[c]&&(d=g.getFlattenedFilter(a[c]))&&(b[c]=d);return b},getWidgetData:function(a){var b={};a&&a.data&&(b.w_id=a.w_id,b.rn_contextData=a.data.rn_contextData,b.rn_contextToken=a.data.rn_contextToken,b.rn_timestamp=a.data.rn_timestamp);return b},getFlattenedFilter:function(a){if("value"in a&&"type"in a&&"key"in a)return{value:a.value,key:a.key,type:a.type}},getCurrentPage:function(){var a=window.location,b=a.pathname,a=a.origin||a.protocol+"//"+a.host;return"/"===b||"/app"===b||"/app/"===b?a+"/app/"+RightNow.Interface.getConfig("CP_HOME_URL"):b.split("/").slice(0,RightNow.Url.getParameterSegment()-1).join("/")}};f=function(){function a(a){return a?c[a]:c}function b(a){if(!a||!a.length||2>a.length)throw Error("You're doing it wrong");this.sources=a;this.multiple=!0}function d(a){return function(){for(var b=0,c=arguments,k;b<this.sources.length;b++)k=this.sources[b],k[a].apply(k,c);return this}}var c={},e=RightNow.EventProvider.extend({overrides:{constructor:function(a,b,d){this.parent();this.sourceID=b;this.Y=a;this.initialFilters={};this.filters={};this.widgetData={};this.options={};this.cancelSearch=!1;delete this.data;delete this.baseDomID;delete this.baseSelector;this._addEventHandler("collect",{pre:function(){this.filters=this.initialFilters},during:function(a){a&&a instanceof RightNow.Event.EventObject&&((a=g.getFlattenedFilter(a.data))&&a.value?this.filters[a.type]=a:delete this.filters[a.type])}});this._addEventHandler("search",{pre:function(b){if(b&&b instanceof RightNow.Event.EventObject){var c=this.options.limit!==b.data.limit?this.options.limit:null;this.options=a.merge(this.options,b.data);c&&(this.options.limit=c)}this.options.params=a.merge(this.options.params,this.widgetData);"page"in this.options&&(this.Y.Object.isEmpty(this.filters)&&(this.filters=this.initialFilters),this.filters.page=this.options.page);this.cancelSearch=!1},during:function(a){!1===a&&(this.cancelSearch=!0)},post:function(){this.cancelSearch?this.fire("searchCancelled",this.filters,this.options):p.go(this.filters,this.options,b,this.options.sourceCount||Object.keys(c).length,this)}});this._addEventHandler("initializeFilters",{pre:function(a){if(a&&a instanceof RightNow.Event.EventObject&&(this.initialFilters=g.getFlattenedFilters(a.data),this.widgetData=g.getWidgetData(a),h.enabled&&(a=Object.keys(c),a[a.length-1]===this.instanceID))){a=g.getFilterUrl(this.initialFilters);var b={};this.Y.Object.each(c,function(a,c){var d=this.Y.one("#rn_"+a.widgetData.w_id+"_HistoryData"),m=this.Y.one("#rn_"+a.widgetData.w_id+"_Content");d&&m&&(d=JSON.parse(d.getHTML()),d.html=m.getHTML(),d._isParsed=!0,b[c]={response:d,filters:this.initialFilters,sourceID:c})},this);h.setCache(a,b);h.addState(a,b,!0)}}});this._addEventHandler("updateHistoryEntry",{pre:function(b){if(h.enabled&&b&&b instanceof RightNow.Event.EventObject){this.options=a.merge(this.options,b.data.data);this.options.params=a.merge(this.options.params,this.widgetData);"page"in this.options&&(this.Y.Object.isEmpty(this.filters)&&(this.filters=this.initialFilters),this.filters.page=this.options.page);for(var c in b.data.update)this.filters[c]=b.data.update[c];b=g.getFilterUrl(this.filters);h.addState(b,null,!0)}}});this._addEventHandler("updateFilters");this._addEventHandler("reset");this.on("reset",function(){this.filters=this.initialFilters;this.page=0},this)},setOptions:function(a){a&&this.sourceID in a&&a[this.sourceID]&&(a=a[this.sourceID]);this.options=this.Y.mix(this.options,a,!0);return this}}});b.prototype={on:d("on"),fire:d("fire"),setOptions:d("setOptions")};return{SearchSource:e,MultipleSourcesWrapper:b,RefreshSources:function(b){var c,d;for(d in b)b.hasOwnProperty(d)&&(c=a(d))&&c.fire("response",new RightNow.Event.EventObject(null,{data:b[d].response})).fire("updateFilters",new RightNow.Event.EventObject(null,{data:b[d].filters}))},get:a,getSearchSources:function(a){return a?(a+"").split(","):[]},add:function(a,b){if(a&&b instanceof e&&!c[a])return c[a]=b}}}();RightNow.SearchConsumer=RightNow.Widgets.extend({constructor:function(){var a=f.getSearchSources(this.data.attrs.source_id),b=f.get(a[0]);1<a.length&&RightNow.UI.DevelopmentHeader.addJavascriptError("A search consumer cannot have more than one search source");b||(b=new f.SearchSource(this.Y,a[0]),f.add(a[0],b));this.searchSource=function(){return b}}});RightNow.SearchProducer=RightNow.Widgets.extend({constructor:function(){for(var a=f.getSearchSources(this.data.attrs.source_id),b=[],d=0,c;d<a.length;d++)c=c=f.get(a[d]),c||(c=new f.SearchSource(this.Y,a[d]),f.add(a[d],c)),b.push(c);if(!b.length)throw Error("No search sources were given");c=1===b.length?c:new f.MultipleSourcesWrapper(b);this.searchSource=function(){return c}}})})();
RightNow.Widgets.SourceSearchField=RightNow.SearchProducer.extend({overrides:{constructor:function(){this.parent();this.input=this.Y.one(this.baseSelector+'_SearchInput');if(this.data.attrs.initial_focus){this.input.focus();}
this.searchSource().on('collect',this.onCollect,this).on('updateFilters',this.onFilterUpdate,this).on('reset',this.onReset,this);RightNow.Event.subscribe('evt_getSearchField',function(){RightNow.Event.fire("evt_sendSearchField",new RightNow.Event.EventObject(this,{data:this.input}));},this);}},onCollect:function(){var searchTerm="";var keywordEntered=this.Y.Lang.trim(this.input.get('value'));if(this.data.attrs.allow_empty_search&&!keywordEntered){searchTerm="*";}
else if(keywordEntered){searchTerm=keywordEntered;}
this.searchSource().setOptions({page:{key:"page",type:"page",value:1}});return new RightNow.Event.EventObject(this,{data:this.Y.merge(this.data.js.filter,{value:searchTerm})});},onFilterUpdate:function(e,eo){this.Y.Object.some(eo[0].data,function(filter){if(filter.key===this.data.js.filter.key){var filterValue=this.Y.Node.create('<textarea>'+filter.value+'</textarea>').get('innerText');this.input.set('value',(filter.value!=='*')?filterValue:'');return true;}},this);},onReset:function(){this.input.set('value',this.data.js.prefill);}});
RightNow.Widgets.SourceSearchButton=RightNow.SearchProducer.extend({overrides:{constructor:function(){this.parent();this.searchButton=this.Y.one(this.baseSelector+"_SubmitButton");if(this.searchButton){this.enableClickListener();this.searchSource().setOptions(this.searchOptions()).setOptions(this.data.js.sources).on('response',this.enableClickListener,this);}}},searchOptions:function(){return this._searchOptions||(this._searchOptions={new_page:this.data.attrs.search_results_url,target:this.data.attrs.target,limit:this.data.attrs.per_page});},search:function(e){e.halt();if(this.searchInProgress)return;this.searchSource().fire('collect');if(this.searchSource().multiple){this.filters=this.searchSource().sources[0].filters;}
else{this.filters=this.searchSource().filters;}
if(this.filters.query&&this.Y.Lang.trim(this.filters.query.value)!==''){if(this.filters.query.key==="kw"&&this.Y.Lang.trim(this.filters.query.value)==="*"){this.filters.direction=this.filters.direction||{};this.filters.direction.value=0;this.filters.sort=this.filters.sort||{};this.filters.sort.value=1;}
this.disableClickListener();this.searchSource().fire('search',new RightNow.Event.EventObject(this,{data:this.searchOptions()}));}
else{RightNow.UI.displayBanner(RightNow.Interface.ASTRgetMessage(this.data.attrs.label_enter_search_keyword),{type:'WARNING',focus:true});}},enableClickListener:function(){this.searchInProgress=false;this.searchButton.on('click',this.search,this);},disableClickListener:function(){this.searchInProgress=true;this.searchButton.detach('click',this.search,this);}});
RightNow.namespace('Custom.Widgets.webForm.customProductDisplay');Custom.Widgets.webForm.customProductDisplay=RightNow.Widgets.extend({constructor:function(){},methodName:function(){}});